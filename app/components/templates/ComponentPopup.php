<?php
/*$fields = json_encode(['onglet1'=>['label'=>'Onglet 1', 'sections'=>
          ['section1'=>['label'=>'Section 1', 'fields'=>
         ['code' => ['label' => 'Code', 'class' => 'text', 'attributes' => ['mandatory' => true, 'controls' => ['isFieldName'], 'max_size' => 30]],
           'label' => ['label' => 'Libellé', 'class' => 'text', 'attributes' => ['mandatory' => true, 'max_size' => 80]],
           'mandatory' => ['label' => 'Obligatoire', 'class' => 'checkbox'],
           'controls' => ['label' => 'Contrôles', 'class' => 'select', 'attributes' => ['list_code' => 'controls', 'multiple' => true]]]],
            'section2'=>['label'=>'Section 2']]],
          'onglet2'=>['label'=>'Onglet 2']]
          );
echo $fields;*/
?>
<div id="JinaPopup">
  <jinapopup :component="component" :instance="instance" :values="values" :lng="lng" :defaultlng="defaultlng" :lnglist="lnglist" :currentonglet="currentonglet"></jinapopup>
</div>
<template id="jinapopup-template">
  <div>
    <div id="JinaPopupInner">
      <div id="lngSwitch">
        <a v-for="(img, code) in lnglist" href="#" :data-lng="code" @click="switchLng($event)" :class="(lng == code ? 'active' : '')"><img :src="'assets/img/flags/'+img" :data-lng="code" :alt="code" :title="code" /></a>
      </div>
      <div class="JinaPopupOngletHandles">
        <div v-for="(onglet, index, pos) in component.fields" :class="(pos == currentonglet ? 'active ' : '')+'JinaPopupOngletHandle'" :data-id="index" :id="index+'-handle'" @click="ongletHandle(pos)">
          <h2>{{onglet.label}}</h2>
        </div>
      </div>
      <div v-for="(onglet, index, pos) in component.fields" :class="(pos == currentonglet ? 'active ' : '')+'JinaPopupOnglet'" :id="index">
        <fieldset v-for="(section, section_id) in onglet.sections" class="JinaPopupSection">
          <h3 v-if="!section.hide" :id="index+'-'+section_id+'-label'" @click="sectionToggle($event)">{{section.label}}</h3>
          <div class="JinaPopupFields">
            <div v-for="(field, code) in section.fields" class="JinaPopupField">
              <template v-if="lng == defaultlng || field.multilingual">
                <div class="JinaPopupFieldInner">
                  <div v-if="lng == defaultlng" class="JinaPopupFieldAction" :id="code+'_actions'" @click="fieldAction(code)">
                    <i class="fa fa-cog"><div class="JinaPopupFieldOptions" :id="code+'_actions_popup'">Mes options pour ce champ<br /></div></i>
                  </div>
                  <label v-if="!field.hide" :for="field.code">{{field.label}}</label>
                  <input v-if="field.class == 'text'" class="medium" type="text" :name="code" :id="code" v-model="values[lng][code]" />
                  <select v-if="field.class == 'select'" :name="code" :id="code" v-model="values[lng][code]">
                  </select>
                  <input v-if="field.class == 'checkbox'" type="checkbox" :name="code" :id="code" v-model="values[lng][code]" />
                  <textarea v-if="field.class == 'textarea'" :name="lng+'-'+code" :id="lng+'-'+code" v-model="values[lng][code]" class="richtext medium"></textarea>
                  <div  v-if="field.class == 'file'">
                    <div class="Jina-drop-helper">Cliquez ou déposez vos fichiers ci-dessous</div>
                    <div class="Jina-drop" @click="dropFile($event)" @drop="getDropped($event, lng, code)" @dragenter="dragEnter($event)" @dragexit="dragExit($event)" @dragover="dragOver($event)">
                      <input type="file" :name="code" :id="code" @change="changeFile($event, lng, code)" @click="$event.stopImmediatePropagation()" multiple />
                      <div v-for="doc in getFieldValue(lng, code, 'docs')">
                        <img v-if="isImage(doc)" :src="this.URL.createObjectURL(doc)" :alt="doc.name" :title="doc.name"/>
                        <span v-if="!isImage(doc)">{{doc.name}}</span>
                        <div class="fa fa-trash" @click="deleteFile($event, lng, code, 'docs', doc)"></div>
                      </div>
                    </div>
                    <button v-if="getFieldValue(lng, code, 'docs').length" class="JinaPopupButton JinaSubmit" @click="submitFiles($event, lng, code)"><div class="jauge">&nbsp;</div>Transmettre les fichiers</button>
                    <div v-if="getFieldValue(lng, code, 'documents').length" class="Jina-doc">
                      <div v-for="document in getFieldValue(lng, code, 'documents')" :class="isImage(document) ? 'JinaImg' : ''">
                        <a :href="getDocURL(document)" target="_blank">
                          <img v-if="isImage(document)" :src="getDocURL(document)" :alt="document.name" :title="document.name"/>
                          <span v-if="!isImage(document)">{{document.name}}</span>
                        </a>
                        <div class="fa fa-trash" @click="deleteFile($event, lng, code, 'documents', document)"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </template>
            </div>
          </div>
        </fieldset>
      </div>
    </div>
    <div id="JinaPopupButtons">
      <button class="JinaPopupButton" id="JinaPopupSave" @click="save()"><i class="fa fa-save"></i></button>
      <button class="JinaPopupButton" id="JinaPopupCancel" @click="close"><i class="fa fa-times"></i></button>
    </div>
  </div>
</template>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </body></html>